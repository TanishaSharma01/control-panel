(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e){e.exports={notice:"The labjack pin values are duplicated in the Python code, beware!",buttons:[{pin:{test_stand:"ETH",labjack_pin:15,full_name:"Main Fuel (Ethanol) Valve",abbrev:"main",name:"ETH Main"},position:{width:2,height:1,x:10.1,y:15.5}},{pin:{test_stand:"ETH",labjack_pin:16,full_name:"Fuel (Ethanol) Fill Valve",abbrev:"fill",name:"ETH Fill"},position:{width:2,height:1,x:6.1,y:12.4}},{pin:{test_stand:"ETH",labjack_pin:17,full_name:"Fuel (Ethanol) Dump/Drain Valve",abbrev:"drain",name:"ETH Drain"},position:{width:2,height:1,x:6.1,y:16}},{pin:{test_stand:"ETH",labjack_pin:8,full_name:"Fuel (Ethanol) Tank Nitrogen Pressurisation Valve",abbrev:"pres",name:"ETH Pressurisation"},position:{width:2,height:1,x:6.4,y:5.3}},{pin:{test_stand:"ETH",labjack_pin:9,full_name:"Fuel (Ethanol) Tank Vent Valve",abbrev:"vent",name:"ETH Vent"},position:{width:2,height:1,x:10.2,y:3.2}},{pin:{test_stand:"ETH",labjack_pin:14,full_name:"Fuel (Ethanol) Line Nitrogen Purge Valve",abbrev:"purge",name:"ETH Purge"},position:{width:2,height:1,x:2.5,y:7.2}},{pin:{test_stand:"LOX",labjack_pin:14,full_name:"Main Oxidiser (LOX) Valve",abbrev:"main",name:"LOX Main"},position:{width:2,height:1,x:16.7,y:15.4}},{pin:{test_stand:"LOX",labjack_pin:16,full_name:"Oxidiser (LOX) Fill Valve",abbrev:"fill",name:"LOX Fill"},position:{width:2,height:1,x:20.6,y:12.3}},{pin:{test_stand:"LOX",labjack_pin:17,full_name:"Oxidiser (LOX) Dump/Drain Valve",abbrev:"drain",name:"LOX Drain"},position:{width:2,height:1,x:20.6,y:15.7}},{pin:{test_stand:"LOX",labjack_pin:9,full_name:"Oxidiser (LOX) Tank Nitrogen Pressurisation Valve",abbrev:"pres",name:"LOX Pressurisation"},position:{width:2,height:1,x:19.7,y:5.3}},{pin:{test_stand:"LOX",labjack_pin:10,full_name:"Oxidiser (LOX) Tank Vent Valve",abbrev:"vent",name:"LOX Vent"},position:{width:2,height:1,x:16.8,y:3.2}},{pin:{test_stand:"LOX",labjack_pin:8,full_name:"Oxidiser (LOX) Line Nitrogen Purge Valve",abbrev:"purge",name:"LOX Purge"},position:{width:2,height:1,x:25.8,y:6.8}},{pin:{test_stand:"LOX",labjack_pin:15,full_name:"Oxidiser (LOX) Line Nitrogen Chill Valve",abbrev:"chill",name:"LOX Chill"},position:{width:2,height:1,x:24,y:14.1}}],sensors:[{pin:{test_stand:"LOX",labjack_pin:5,sensorNumber:0,full_name:"LOX Nitrogen Pressurant Sensor",abbrev:"lox_n2"},position:{width:2.9,height:3,x:24.9,y:2.5}},{pin:{test_stand:"LOX",labjack_pin:4,sensorNumber:1,full_name:"LOX Tank Pressure Sensor",abbrev:"lox_tank"},position:{width:3.1,height:3.8,x:15.8,y:9.2}},{pin:{test_stand:"ETH",labjack_pin:5,sensorNumber:2,full_name:"Ethanol Nitrogen Pressurant Sensor",abbrev:"eth_n2"},position:{width:2.9,height:3,x:1.8,y:2.5}},{pin:{test_stand:"ETH",labjack_pin:4,sensorNumber:3,full_name:"Ethanol Tank Pressure Sensor",abbrev:"eth_tank"},position:{width:3,height:3.8,x:9.2,y:9.2}},{pin:{test_stand:"LOX",labjack_pin:2,sensorNumber:4,full_name:"Cryogenic Flow Sensor",abbrev:"lox_cryo"},position:{width:3.5,height:3,x:26.5,y:17}}]}},52:function(e,t,n){e.exports=n(61)},57:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var a=n(8),r=n(7),i=n(17),o=n(18),l=n(34),s=n(30),c=n(35),u=n(29),h=n(0),m=n.n(h),f=n(13),d=n.n(f),p=(n(57),n(22)),y=n(79),g=n(4),v=n(89);function b(e){var t=e.children;return m.a.createElement("div",{style:{width:"100%",padding:"6px",height:"40px"}},m.a.createElement("h1",null,t))}function k(){return m.a.createElement("div",{className:"top-bar"},m.a.createElement("img",{src:"./logo.png",alt:"logo"}),m.a.createElement("h1",null,"Test Stand Control Panel"))}function E(e){var t=e.children,n=e.title,a=Object(p.a)(e,["children","title"]);return m.a.createElement("div",Object.assign({className:"panel"},a),m.a.createElement(b,null,n),m.a.createElement(y.a,{style:{width:"100%",height:"calc(100% - 52px"}},t))}var x=Object(g.a)(function(e){return{root:{width:60,height:32,padding:1,display:"flex",overflow:"visible"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(26px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{marginLeft:1,marginTop:1,width:28,height:28,boxShadow:"none"},track:{border:"1px solid ".concat(e.palette.grey[500]),borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}})(v.a);Object(g.a)(function(e){return{root:{position:"absolute",top:"-10px",left:"-10px",width:"6vw"}}})(v.a);function w(e){var t=e.value,n=e.setValue;return m.a.createElement("div",{className:"toggle-switch",style:{width:60}},m.a.createElement("span",{className:t?"inactive":"active"},"Off"),m.a.createElement(x,{checked:t,onChange:function(){return n(!t)}}),m.a.createElement("span",{className:t?"active":"inactive",style:{textAlign:"right",width:"100%",display:"block"}},"On"))}function O(e){var t="";t=e.children?e.children:m.a.createElement(w,{value:e.switchValue,setValue:e.setSwitchValue});var n=e.label?{cursor:"help",borderBottom:"1px dotted #333"}:{};return m.a.createElement("div",{className:"safety-card"},m.a.createElement("h2",{title:e.label,style:Object(a.a)({},n,e.style||{})},e.title),t)}var j={LINE_POWERED:"\u2705",BATTERY_POWERED:"\ud83d\udd0b",UNKNOWN:"\u2754"},S={LINE_POWERED:"Powered",BATTERY_POWERED:"Battery",UNKNOWN:"Unknown"};function M(e){var t=e.state,n=e.emit,a=e.sockStatus,r=e.that,i=null!==t.data&&t.data.arming_switch,o=null!==t.data&&t.data.manual_switch,l=null!==t.data&&t.data.data_logging,s=null===t.data?"UNKNOWN":t.data.UPS_status,c=j[s]+" "+S[s],u=a===WebSocket.OPEN?m.a.createElement("div",{style:{color:"green"}},"Connected"):m.a.createElement("div",{style:{color:"red"}}," Disconnected");return m.a.createElement(E,{title:"Safety",className:"panel safety"},m.a.createElement("div",{className:"flex",style:{justifyContent:"flex-start"}},m.a.createElement(O,{title:"Arming",label:"Controls if the state can change",isButton:"false",switchValue:i,setSwitchValue:function(e){return n("ARMINGSWITCH",e)}}),m.a.createElement(O,{title:"Manual",label:"Allow manual pin operation",isButton:"false",switchValue:o,setSwitchValue:function(e){return n("MANUALSWITCH",e)}}),m.a.createElement(O,{title:"Logging",label:"Logging data",isButton:"false",switchValue:l,setSwitchValue:function(e){return n("DATALOG",e)}}),m.a.createElement(O,{title:"Server IP",label:"Local IP address of the Raspberry Pi. Must be on the same network. If it's incorrect no new data will appear"},m.a.createElement("input",{value:t.wsAddress,size:"10",onChange:function(e){r.setState({wsAddress:e.target.value},function(){localStorage.setItem("wsaddr",e.target.value),r.connect()})},placeholder:t.defaultWSAddress})),m.a.createElement(O,{title:"Ping",label:"Time delay to reach the server",style:{width:40}},t.ping?t.ping:"0","ms"),m.a.createElement("div",{style:{paddingTop:6,display:"flex",gap:"10px"}},m.a.createElement(O,{title:"Status"},u),s&&m.a.createElement(O,{title:"UPS"},c))))}var _=n(6),N=n(27);function L(e,t){return parseFloat(e.toPrecision(t))}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(0===e)return"0 "+t;for(var a=[["T",4],["G",3],["M",2],["K",1],["",0],["m",-1],["\u03bc",-2],["n",-3]],r=0;r<a.length;r++){var i=Math.pow(1e3,a[r][1]);if(Math.abs(e)>=i)return L(e/i,n)+" "+a[r][0]+t}return L(e/Math.pow(1e3,-4),n)+" p"+t}function C(e,t,n,a){for(var r=function e(t){if(t<0)return e(-t);if(0===t)return 0;var n=-Math.floor(Math.log10(t)),a=Math.log10(t)+n,r=[0,Math.log10(2),Math.log10(5),1],i=r[0],o=r[1],l=r[2],s=r[3],c=[Math.abs(a-i),Math.abs(a-o),Math.abs(a-l),Math.abs(a-s)],u=Math.min.apply(Math,c);return(u===c[0]?1:u===c[1]?2:u===c[2]?5:10)*Math.pow(10,-n)}((t-e)/n),i=[],o=Math.ceil(e/r)*r,l=Math.floor(t/r)*r,s=o;s<=l;s+=r)Math.abs(s)<1e-10&&(s=0),i.push({tick:s,label:T(s,a)});return i}function P(e,t,n){for(var a,r=0,i=n-1;r<=i;){var o=e(a=Math.floor((r+i)/2));if(o===t)return a;o<t?r=a+1:i=a-1}return i}function A(e,t){return e?t?[Math.min(e[0],t[0]),Math.max(e[1],t[1])]:e:t}function X(e,t){var n=Object(_.a)(e,2);return function(e,t){var n=Object(_.a)(e,2),a=n[0],r=n[1],i=Object(_.a)(t,2);return[a+(r-a)*i[0],r-(r-a)*(1-i[1])]}([n[0],n[1]],[-t,1+t])}function F(e,t,n){return Math.max(t,Math.min(n,e))}function W(e,t){var n=Object(_.a)(e,2),a=n[0],r=n[1],i=Object(_.a)(t,2),o=i[0],l=i[1];return a<o&&r>l?[o,l]:a<o?[o,o+(r-a)]:r>l?[l-(r-a),l]:[a,r]}function V(e){var t;try{t=e()}catch(n){if(!(n instanceof TypeError))throw n;t=void 0}return t}var H=function(){function e(t){Object(i.a)(this,e),this.capacity=t,this.array=new Float64Array(this.capacity),this.size=0,this.chunks=0}return Object(o.a)(e,[{key:"push",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{this.array.set(t,this.size),this.size+=t.length,this.chunks++}catch(a){console.error(this,t),console.error(a)}}},{key:"shrink",value:function(){var e=new Float64Array(this.size);e.set(this.array.subarray(0,this.size)),this.array=e}},{key:"filterMapChunks",value:function(e,t){for(var n=[],a=0;a<this.chunks;a++)e(a)&&n.push(t(a));return n}}]),e}(),I=function(e){function t(e){return Object(i.a)(this,t),Object(l.a)(this,Object(s.a)(t).call(this,4*e))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"time",value:function(e){return this.array[4*e]}},{key:"mean",value:function(e){return this.array[4*e+1]}},{key:"min",value:function(e){return this.array[4*e+2]}},{key:"max",value:function(e){return this.array[4*e+3]}},{key:"updateDecimation",value:function(e){var t=e.chunks;this.chunks=Math.ceil(t/2),this.size=4*this.chunks;var n=this.size;if(0!==t)switch(t%2){case 0:this.array[n-4]=e.time(t-1),this.array[n-3]=(e.mean(t-2)+e.mean(t-1))/2,this.array[n-2]=Math.min(e.min(t-2),e.min(t-1)),this.array[n-1]=Math.max(e.max(t-2),e.max(t-1));break;case 1:this.array[n-4]=e.time(t-1),this.array[n-3]=e.mean(t-1),this.array[n-2]=e.min(t-1),this.array[n-1]=e.max(t-1)}}}]),t}(H),B=function(e){function t(e){return Object(i.a)(this,t),Object(l.a)(this,Object(s.a)(t).call(this,2*e))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"time",value:function(e){return this.array[2*e+0]}},{key:"mean",value:function(e){return this.array[2*e+1]}},{key:"min",value:function(e){return this.array[2*e+1]}},{key:"max",value:function(e){return this.array[2*e+1]}}]),t}(H),z=function(){function e(){Object(i.a)(this,e),this.n_bound=12,this.capacity=524288,this.arrays={},this.arrays[0]=new B(this.capacity);for(var t=1;t<=this.n_bound;t++)this.arrays[t]=new I(this.capacity>>t)}return Object(o.a)(e,[{key:"push",value:function(e,t){this.arrays[0].push(e,t);for(var n=1;n<=this.n_bound;n++)this.arrays[n].updateDecimation(this.arrays[n-1])}},{key:"sample",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,r=[Math.max(P(function(e){return n.arrays[0].time(e)},e,this.arrays[0].chunks),0),Math.min(P(function(e){return n.arrays[0].time(e)},t,this.arrays[0].chunks)+2,this.arrays[0].chunks)],i=r[1]-r[0],o=Math.min(this.n_bound,Math.max(0,1+Math.floor(Math.log(i/a+.01)/Math.log(2))))||0,l=[Math.max(P(function(e){return n.arrays[o].time(e)},e,this.arrays[o].chunks),0),Math.min(P(function(e){return n.arrays[o].time(e)},t,this.arrays[o].chunks)+2,this.arrays[o].chunks)],s=l[1]-l[0],c=new Array(s);c.min=1/0,c.max=-1/0;for(var u=0;u<s;u++)c[u]=[this.arrays[o].time(l[0]+u),this.arrays[o].mean(l[0]+u),this.arrays[o].min(l[0]+u),this.arrays[o].max(l[0]+u)],c.min=Math.min(c.min,c[u][2]),c.max=Math.max(c.max,c[u][3]);return c.decimated=o>0,c.getPoints=function(e,t,n){for(var a="",r=0;r<s;r++)a+="".concat(e(c[r][0]-n).toFixed(1),",").concat(Math.round(t(c[r][1]))," ");return a},c.getMinMaxPoints=function(e,t,n){for(var a="",r=0;r<s;r++)a+="".concat(e(c[r][0]-n).toFixed(1),",").concat(Math.round(t(c[r][2]))," ");for(var i=s-1;i>=0;i--)a+="".concat(e(c[i][0]-n).toFixed(1),",").concat(Math.round(t(c[i][3]))," ");return a},c}},{key:"samplePreview",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,n=this.arrays[0].chunks,a=Math.ceil(n/t),r=1/0,i=-1/0,o=this.arrays[0].filterMapChunks(function(e){return e%a===0||e===n-1},function(t){var n=e.arrays[0].mean(t);return r=Math.min(r,n),i=Math.max(i,n),[e.arrays[0].time(t),n]});return o.min=r,o.max=i,o.getPoints=function(e,t,n){for(var a="",r=0;r<o.length;r++)a+="".concat(e(o[r][0]-n).toFixed(1),",").concat(Math.round(t(o[r][1]))," ");return a},o}},{key:"shrink",value:function(){for(var e=0;e<=this.n_bound;e++)this.arrays[e].shrink()}}]),e}(),D=function(){function e(){Object(i.a)(this,e),this.series=[new z],this.enabled=!0}return Object(o.a)(e,[{key:"push",value:function(e,t){isNaN(e)||isNaN(t)?this.series[this.series.length-1].arrays[0].chunks>0&&(this.series[this.series.length-1].shrink(),this.series.push(new z)):this.series[this.series.length-1].push(e,t)}},{key:"sample",value:function(e,t,n){var a=this.series.map(function(a){return a.sample(e,t,n)});return a.totalLength=a.reduce(function(e,t){return e+t.length},0),a.splitPointIndex=function(e){for(var t=0;t<a.length;t++){if(e<a[t].length)return[t,e];if((e-=a[t].length)<0)return[-1,-1]}},a.fromPointIndex=function(e){var t=a.splitPointIndex(e),n=Object(_.a)(t,2),r=n[0],i=n[1];return a[r][i]},a.min=Math.min.apply(Math,Object(r.a)(a.map(function(e){return e.min}))),a.max=Math.max.apply(Math,Object(r.a)(a.map(function(e){return e.max}))),a}},{key:"samplePreview",value:function(e){if(0===this.series.length||0===this.series[0].arrays[0].chunks)return[];var t=[this.minTime(),this.maxTime()];if(t[0]===t[1])return[];var n=this.series.filter(function(e){return e.arrays[0].chunks}).map(function(n){var a=(n.arrays[0].time(n.arrays[0].chunks-1)-n.arrays[0].time(0))/(t[1]-t[0]);return n.samplePreview(e*a)});return n.min=Math.min.apply(Math,Object(r.a)(n.map(function(e){return e.min}))),n.max=Math.max.apply(Math,Object(r.a)(n.map(function(e){return e.max}))),n}},{key:"minTime",value:function(){var e=this;return V(function(){return e.series[0].arrays[0].time(0)})}},{key:"maxTime",value:function(){for(var e=this.series.length-1;e>=0;e--)if(this.series[e].arrays[0].chunks>0)return this.series[e].arrays[0].time(this.series[e].arrays[0].chunks-1);return NaN}}]),e}(),R=function(){function e(t){Object(i.a)(this,e),this.series=t,this.keys=Array.from(Object.keys(this.series)),this.arrays=this.objectMap(function(e){return new D})}return Object(o.a)(e,[{key:"objectMap",value:function(e){return this.keys.reduce(function(t,n){return t[n]=e(n),t},{})}},{key:"minTime",value:function(){var e=this;return Math.min.apply(Math,Object(r.a)(this.keys.map(function(t){return e.arrays[t].minTime()}).filter(function(e){return e})))}},{key:"sample",value:function(e,t){var n=this,a=this.objectMap(function(a){var i;return n.arrays[a].enabled&&(i=n.arrays[a]).sample.apply(i,Object(r.a)(e).concat([t]))});return a.min=Math.min.apply(Math,Object(r.a)(this.keys.filter(function(e){return n.arrays[e].enabled}).map(function(e){return a[e].min}))),a.max=Math.max.apply(Math,Object(r.a)(this.keys.filter(function(e){return n.arrays[e].enabled}).map(function(e){return a[e].max}))),a}},{key:"samplePreview",value:function(e){var t=this,n=this.objectMap(function(n){return t.arrays[n].enabled&&t.arrays[n].samplePreview(e)});return n.min=Math.min.apply(Math,Object(r.a)(this.keys.filter(function(e){return t.arrays[e].enabled}).map(function(e){return n[e].min}))),n.max=Math.max.apply(Math,Object(r.a)(this.keys.filter(function(e){return t.arrays[e].enabled}).map(function(e){return n[e].max}))),n}},{key:"toggleSeries",value:function(e){this.arrays[e].enabled=!this.arrays[e].enabled}}]),e}(),U=n(26);function G(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){var n=U.buttons.filter(function(n){return n.pin.labjack_pin===e&&n.pin.test_stand===t})[0];if(n)return n}return U.buttons.filter(function(t){return t.pin.labjack_pin===e})[0]}window.enablePageScroll=N.enablePageScroll,window.disablePageScroll=N.disablePageScroll;var Y=null,J=[-10,10],K=function(e){return document.dispatchEvent(new CustomEvent("datalogger-new-data",{detail:e}))};var $=function(e){var t=e.series,n=e.unit,i=(e.label,Array.from(Object.keys(t))),o=new R(t),l=[],s=function(){},c=function(){return requestAnimationFrame(s)};return document.addEventListener("datalogger-new-data",function(e){var t,n=e.detail,a=G(i);try{for(a.s();!(t=a.n()).done;){var r=t.value;r in n&&o.arrays[r].push(n.time,n[r])}}catch(l){a.e(l)}finally{a.f()}c()}),document.addEventListener("datalogger-new-event",function(e){var t=e.detail;l.push(Object(a.a)({},t,{key:l.length})),c()}),function(e){var c=e.currentSeconds,u=m.a.useRef(null);s=m.a.useReducer(function(e){return e+1},0)[1];var h=790,f=510;c||(c=(new Date).getTime()/1e3);var d,y,g,v=o.minTime(),b=m.a.useState([-3]),k=Object(_.a)(b,2),E=k[0],x=k[1],w=function(e){if(1===e.length||e[1]>=c){var t=1===e.length?e[0]:e[0]-c,n=Math.min(-10,v-c);x([F(t,n,0)])}else e=[Math.min.apply(Math,Object(r.a)(e)),Math.max.apply(Math,Object(r.a)(e))],x([F(e[0],v,e[1]-.01),F(e[1],e[0],c)])},O=1===E.length?[c+E[0],c]:E,j=[O[0]-c,O[1]-c],S=o.sample(O,h),M=o.samplePreview(h);d=Y,y=A([S.min,S.max],J),g=.1;var L=X(Y=d?y?[d[0]+(y[0]-d[0])*g,d[1]+(y[1]-d[1])*g]:d:y,.2),H=[v,c],I=1,B=1,z=1,D=1,R=function(e){return I+e*(h-I-B)},U=function(e){return z+e*(460-z-D)},G=function(e){return(e-I)/(h-I-B)},q=function(e){return R((e-j[0])/(j[1]-j[0]))},Q=function(e){return U(1-(e-L[0])/(L[1]-L[0]))},K=function(e){return j[0]+G(e)*(j[1]-j[0])},$=6,Z=12,ee=function(e){return t=1-(e-M.min)/(M.max-M.min),$+t*(50-$-Z);var t},te=function(e){return R(1-e/(Math.min(H[1]-10,H[0])-H[1]))},ne=function(e){return(1-G(e))*(Math.min(H[1]-10,H[0])-H[1])},ae=C.apply(void 0,j.concat([4,"s"])),re=C.apply(void 0,Object(r.a)(L).concat([6,"psi"])),ie=m.a.useState(null),oe=Object(_.a)(ie,2),le=oe[0],se=oe[1],ce=i.map(function(e){if(!S[e]||!S[e].length)return null;var t=P(function(t){return S[e].fromPointIndex(t)[0]},c+K(le),S[e].totalLength-1);if(-1===t)return null;var n=S[e].splitPointIndex(t),a=Object(_.a)(n,2),r=a[0],i=a[1];return i>=S[e][r].length-1||r<0||i<0?null:[r,i]}).map(function(e,t){if(null===e)return"";var a,r,o,l,s,u=Object(_.a)(e,2),h=u[0],m=u[1],f=S[i[t]],d=(a=f[h][m][0],r=f[h][m][1],o=f[h][m+1][0],l=f[h][m+1][1],s=c+K(le),r+(l-r)*(s-a)/(o-a));return"".concat(i[t],": ").concat(T(d,n))}).filter(function(e){return e.length}),ue=le>R(1)-200,he=m.a.useState(!1),me=Object(_.a)(he,2),fe=me[0],de=me[1],pe=m.a.useState(null),ye=Object(_.a)(pe,2),ge=ye[0],ve=ye[1],be=function(e){return e.clientX-V(function(){return u.current.getBoundingClientRect().left})},ke=l.map(function(e){var t=e.time,n=Object(p.a)(e,["time"]);return Object(a.a)({x:q(t-c)},n)}).filter(function(e){var t=e.x;return t>=R(0)-10&&t<=R(1)}),Ee=O[1]-O[0]<15;m.a.useEffect(function(){document.body.addEventListener("mouseup",function(){de(!1),ve(null),Pe(!1),We(null),je(!1),Ne(null)})},[]);var xe=m.a.useState(!1),we=Object(_.a)(xe,2),Oe=we[0],je=we[1],Se=m.a.useState(null),Me=Object(_.a)(Se,2),_e=Me[0],Ne=Me[1],Le=m.a.useState(!1),Te=Object(_.a)(Le,2),Ce=Te[0],Pe=Te[1],Ae=m.a.useState(null),Xe=Object(_.a)(Ae,2),Fe=Xe[0],We=Xe[1],Ve=function(e,t){je(!0),Ne(t)},He=function(e){var t=be(e);if(Ce){var n=Object(_.a)(Fe,2),a=n[0],i=n[1],o=ne(t)-a,l=[i[0]+o,i[1]+o];w(W(l,H))}if(Oe){var s=_e,u=Object(r.a)(O);u[s]=F(c+ne(t),Math.min(H[1]-10,H[0]),H[1]),0===s?u[0]=Math.min(u[1]-.01,u[0]):u[1]=Math.max(u[0]+.01,u[1]),w(u)}};return m.a.createElement("div",{onMouseMove:function(e){return Ce?He(e):function(e){var t=be(e);if(se(t),fe){var n=Object(_.a)(ge,2),a=n[0],r=n[1],i=K(a)-K(t),o=[r[0]+i,r[1]+i];o=W(o,A(H,[c-10,c])),w(o)}}(e)}},m.a.createElement("svg",{viewBox:"0 0 ".concat(h," ").concat(460),xmlns:"http://www.w3.org/2000/svg",width:h,height:460,style:{userSelect:"none",fontFamily:"sans-serif",display:"block"},ref:u,onMouseOver:function(){return Object(N.disablePageScroll)()},onMouseOut:function(e){var t=u.current.getBoundingClientRect();Object(N.enablePageScroll)(),(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&se(null)},onMouseDown:function(e){de(!0),ve([be(e),O])},onWheel:function(e){var t=e.deltaX+e.deltaY,n=1===E.length?O[1]:le?c+K(le):(O[0]+O[1])/2,a=Math.max(n+(O[0]-n)*Math.pow(1.001,t),Math.min(H[0]+.01,c-10)),r=Math.min(n+(O[1]-n)*Math.pow(1.001,t),H[1]);w([Math.min(a,r-.01),r])}},ae.map(function(e){var t=e.tick;return e.label,m.a.createElement("line",{key:t,x1:q(t),y1:U(1),x2:q(t),y2:U(0),stroke:"#ddd"})}),m.a.createElement("line",{x1:0,y1:U(1),x2:h,y2:U(1),stroke:"#888",strokeWidth:"2"}),re.map(function(e){var t=e.tick;return e.label,m.a.createElement("line",{key:t,x1:R(0),y1:Q(t),x2:R(1),y2:Q(t),stroke:"#ddd"})}),m.a.createElement("line",{x1:R(0),y1:0,x2:R(0),y2:f,stroke:"#888",strokeWidth:"2"}),ke.map(function(e,t){var n=e.x,a=e.label,r=e.key;return m.a.createElement("g",{key:r},m.a.createElement("line",{x1:n,y1:U(0),x2:n,y2:U(1),stroke:"#333",strokeWidth:"1",strokeDasharray:"2 4"}),Ee&&m.a.createElement("text",{x:n+5,y:U(1)-t%10*12-20,textAnchor:"start",alignmentBaseline:"text-after-edge",fontSize:"12"},a))}),i.map(function(e){return m.a.createElement("g",{key:e},S[e]&&S[e].map(function(n,a){return n.length&&n.decimated&&m.a.createElement("polygon",{key:a,points:n.getMinMaxPoints(q,Q,c),fill:t[e].color,opacity:"0.5",stroke:"none",strokeWidth:"0"})}),S[e]&&S[e].map(function(n,a){return n.length&&m.a.createElement("polyline",{key:a,points:n.getPoints(q,Q,c),fill:"none",stroke:t[e].color,strokeWidth:"1"})}))}),ae.map(function(e){var t=e.tick,n=e.label;return q(t)-R(0)>40&&m.a.createElement("text",{key:t,x:q(t),y:U(1)-2,textAnchor:"middle",alignmentBaseline:"after-edge",fontSize:"12"},n)}),re.map(function(e){var t=e.tick,n=e.label;return U(1)-Q(t)>20&&m.a.createElement("text",{key:t,x:R(0)+2,y:Q(t),textAnchor:"start",alignmentBaseline:"after-edge",fontSize:"12"},n)}),ce.length&&le>R(0)&&m.a.createElement("g",null,m.a.createElement("line",{x1:le,y1:U(0),x2:le,y2:U(1),stroke:"black",strokeWidth:"1"}),ce.map(function(e,t){return m.a.createElement("text",{key:t,x:Math.max(50,Math.min(le+(ue?-5:5),R(1)-100)),y:U(0)+18+20*t,textAnchor:ue?"end":"start",alignmentBaseline:"text-after-edge",fontSize:"12"},e)})),i.map(function(e,n){return m.a.createElement("g",{key:e,onClick:function(t){return o.toggleSeries(e)},cursor:"pointer"},m.a.createElement("rect",{x:690,y:20*n,width:"100",height:"20",fill:"transparent"}),m.a.createElement("circle",{r:"4",fill:o.arrays[e].enabled?t[e].color:"lightgrey",cx:780,cy:12+20*n}),m.a.createElement("text",{fontSize:"12",x:770,textAnchor:"end",alignmentBaseline:"middle",fill:o.arrays[e].enabled?t[e].color:"lightgrey",y:13+20*n},e))})),m.a.createElement("svg",{viewBox:"0 0 ".concat(h," ",50),xmlns:"http://www.w3.org/2000/svg",width:h,height:50,style:{userSelect:"none",fontFamily:"sans-serif",display:"block"},onMouseOut:function(e){Object(N.enablePageScroll)()},onMouseMove:He,onMouseDown:function(e){Pe(!0),We([ne(be(e)),O])}},m.a.createElement("rect",{x:te(j[0]),y:-2,width:te(j[1])-te(j[0]),height:54,fill:"#eee",stroke:"#999",strokeWidth:"2"}),i.map(function(e){return m.a.createElement("g",{key:e},M[e]&&M[e].map(function(n,a){return n.length&&m.a.createElement("polyline",{key:a,points:n.getPoints(te,ee,c),fill:"none",stroke:t[e].color,strokeWidth:"1"})}))}),m.a.createElement("text",{x:"2",y:"50",alignmentBaseline:"text-after-edge",textAnchor:"start",fontSize:"12",fill:"grey"},Math.max(10,Math.round(H[1]-H[0])),"s ago"),m.a.createElement("text",{x:788,y:"50",alignmentBaseline:"text-after-edge",textAnchor:"end",fontSize:"12",fill:"grey"},"now"),m.a.createElement("rect",{x:te(j[1])-4,y:10,width:8,height:30,fill:"#999",stroke:"none",strokeWidth:"0",rx:"4"}),m.a.createElement("rect",{x:te(j[0])-4,y:10,width:8,height:30,fill:"#999",stroke:"none",strokeWidth:"0",rx:"4"}),m.a.createElement("rect",{x:te(j[1])-6,onMouseDown:function(e){return Ve(0,1)},y:"0",width:"16",height:"50",fill:"transparent",stroke:"none",strokeWidth:"0",cursor:"col-resize"}),m.a.createElement("rect",{x:te(j[0])-10,onMouseDown:function(e){return Ve(0,0)},y:"0",width:"16",height:"50",fill:"transparent",stroke:"none",strokeWidth:"0",cursor:"col-resize"}),1!==E.length&&m.a.createElement("g",{cursor:"pointer",onClick:function(){return w([E[0]-E[1]])}},m.a.createElement("rect",{x:774,y:"2",width:"15",height:"18",fill:"#999",stroke:"none",strokeWidth:"0",rx:"4"}),m.a.createElement("polyline",{points:"".concat(779,",6 ").concat(785,",11 ").concat(779,",16"),fill:"none",stroke:"#fff",strokeWidth:"2"}))),m.a.createElement("button",{onClick:function(){var e=u.current,t=(new XMLSerializer).serializeToString(e),n=new Blob([t],{type:"image/svg+xml"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download="graph.svg",r.click()}},"Download SVG"))}}({unit:"psi",series:{"LOX Tank":{color:"#000"},"LOX N2":{color:"#f00"},"ETH Tank":{color:"#3d6"},"ETH N2":{color:"#09f"}}});function Z(e){var t=e.state;return m.a.createElement(E,{title:"Graphs",className:"panel graphs",style:{maxWidth:"1000px",width:"800px",height:"650px",overflow:"hidden"}},m.a.createElement($,{currentSeconds:V(function(){return t.data.time})}))}var ee=n(46),te=n(82),ne=n(83),ae=n(84),re=n(85),ie=n(86);function oe(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return le(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function se(){se=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(S){l=function(e,t,n){return e[t]=n}}function s(e,t,n,a){var r=t&&t.prototype instanceof h?t:h,i=Object.create(r.prototype),o=new w(a||[]);return i._invoke=function(e,t,n){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return j()}for(n.method=r,n.arg=i;;){var o=n.delegate;if(o){var l=k(o,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var s=c(e,t,n);if("normal"===s.type){if(a=n.done?"completed":"suspendedYield",s.arg===u)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(a="completed",n.method="throw",n.arg=s.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(S){return{type:"throw",arg:S}}}e.wrap=s;var u={};function h(){}function m(){}function f(){}var d={};l(d,r,function(){return this});var p=Object.getPrototypeOf,y=p&&p(p(O([])));y&&y!==t&&n.call(y,r)&&(d=y);var g=f.prototype=h.prototype=Object.create(d);function v(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function b(e,t){var a;this._invoke=function(r,i){function o(){return new t(function(a,o){!function a(r,i,o,l){var s=c(e[r],e,i);if("throw"!==s.type){var u=s.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){a("next",e,o,l)},function(e){a("throw",e,o,l)}):t.resolve(h).then(function(e){u.value=e,o(u)},function(e){return a("throw",e,o,l)})}l(s.arg)}(r,i,a,o)})}return a=a?a.then(o,o):o()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=c(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function O(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return m.prototype=f,l(g,"constructor",f),l(f,"constructor",m),m.displayName=l(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(b.prototype),l(b.prototype,i,function(){return this}),e.AsyncIterator=b,e.async=function(t,n,a,r,i){void 0===i&&(i=Promise);var o=new b(s(t,n,a,r),i);return e.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},v(g),l(g,o,"Generator"),l(g,r,function(){return this}),l(g,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=O,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;x(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function ce(e){return m.a.createElement(te.a,{style:e.inFlight?{background:"#94F690"}:{}},m.a.createElement(ne.a,{align:"right"},e.name[0]+e.name.substring(1).toLowerCase()),m.a.createElement(ne.a,{colSpan:"2"},e.stand?function(){if(!e.stand)return null;var t=Q(e.pin,e.stand);return t&&t.pin&&t.pin.name||"Unknown Pin ".concat(e.pin)}():((e.inFlight?e.remaining:e.ms)/1e3).toFixed(1)+"s"))}function ue(e){var t=e.state,n=e.emit,i=Object(h.useState)(""),o=Object(_.a)(i,2),l=o[0],s=o[1],c=Object(h.useState)(!1),u=Object(_.a)(c,2),f=u[0],d=u[1],p=Object(h.useState)([]),y=Object(_.a)(p,2),g=y[0],v=y[1],b=t.data&&t.data.current_sequence||[],k=null===t.data?null:t.data.command_in_flight,x=!!t.data&&3===t.data.status,w=b.length>0||null!==k,j=function(){var e=Object(ee.a)(se().mark(function e(){var t;return se().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=prompt("Enter a sequence name like 'operation' (lowercase without quotes). (This loads from a sequence file in src/sequences on the server RPi)"))){e.next=5;break}return s(t),e.next=5,n("SETSEQUENCE",t);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),S=function(e){try{if(!e||"object"!==typeof e)return"";if("Sleep"===e.name)return"Sleep(seconds=".concat((e.ms/1e3).toFixed(1),")");if("Open"===e.name||"Close"===e.name){if(!e.stand)return"";var t="Unknown";try{e.pin&&Q(e.pin,e.stand)&&Q(e.pin,e.stand).pin&&(t=Q(e.pin,e.stand).pin.name)}catch(n){console.error("Error getting pin name:",n)}return"".concat(e.name,"(").concat(e.stand,".").concat(t,")")}return""}catch(n){return console.error("Error formatting command:",n),""}},M=t.data&&t.data.arming_switch,N={fontSize:"12px",padding:"5px 8px",marginBottom:"5px",width:"100%"};return m.a.createElement(E,{title:"Sequences"},m.a.createElement("div",{className:"flex"},m.a.createElement("div",{style:{width:"200px",borderRight:"1px solid #999",height:"100%"}},m.a.createElement("div",{className:"frame"},m.a.createElement("h2",{style:{fontSize:"16px",margin:"5px 0"}},"Start"),m.a.createElement("div",null,m.a.createElement("button",{onClick:j,disabled:!M||f,style:N},"Choose sequence")),m.a.createElement("button",{onClick:function(){return n("BEGINSEQUENCE",null)},style:Object(a.a)({},N,{backgroundColor:M&&!f?"lime":"lightgrey",cursor:M&&!f?"pointer":"default"}),disabled:!M||f},"Start"),m.a.createElement(O,{title:"Abort",style:{margin:"5px 0"}},m.a.createElement("button",{onClick:function(){return n("ABORTSEQUENCE",e);var e},style:Object(a.a)({},N,{backgroundColor:M&&!f?"tomato":"lightgrey",cursor:M&&!f?"pointer":"default"}),disabled:!M||f},"ABORT")),m.a.createElement("div",{style:{marginTop:"5px",marginBottom:"5px"}},f?m.a.createElement(m.a.Fragment,null,m.a.createElement("button",{onClick:function(){var e=g.filter(function(e){return e.trim()});n("SAVESEQUENCE",{name:l,commands:e}),d(!1),alert("Sequence saved!"),n("SETSEQUENCE",l)},style:Object(a.a)({},N,{backgroundColor:"lime",cursor:"pointer"})},"Save"),m.a.createElement("button",{onClick:function(){d(!1)},style:Object(a.a)({},N,{backgroundColor:"#ff9999",cursor:"pointer"})},"Cancel")):m.a.createElement("button",{onClick:function(){if(l||!w){console.log("Current sequences:",b),console.log("Current executing command:",k);var e=[];if(k)try{var t=S(k);t&&e.push(t)}catch(o){console.error("Error formatting executing command:",o)}if(b&&Array.isArray(b)){var n,a=oe(b);try{for(a.s();!(n=a.n()).done;){var r=n.value;try{var i=S(r);i&&e.push(i)}catch(o){console.error("Error formatting sequence command:",o)}}}catch(s){a.e(s)}finally{a.f()}}0===e.length&&e.push("Close(ETH.Vent)","Close(LOX.Vent)","Sleep(seconds=5.0)","Open(ETH.Pressure)","Open(LOX.Pressure)","Sleep(seconds=15.0)","Open(ETH.Main)","Open(LOX.Main)","Sleep(seconds=10.0)","Close(ETH.Main)","Close(LOX.Main)","Open(ETH.Purge)","Open(LOX.Purge)","Close(ETH.Pressure)","Close(LOX.Pressure)","Open(ETH.Vent)","Open(LOX.Vent)","Sleep(seconds=3.0)","Close(ETH.Purge)","Close(LOX.Purge)"),console.log("Command strings for editor:",e),v(e),d(!0)}else alert("Please choose a sequence first using the 'Choose sequence' button")},disabled:!w||!M,style:Object(a.a)({},N,{backgroundColor:w&&M?"#2196f3":"lightgrey",color:"white",cursor:w&&M?"pointer":"default"})},"Edit")))),m.a.createElement("div",{style:{overflow:"auto",width:"600px",height:"100%"}},f?m.a.createElement("div",{style:{padding:"10px"}},m.a.createElement("h3",{style:{margin:"0 0 10px 0"}},"Editing Sequence: ",l),m.a.createElement("div",{style:{marginBottom:"10px"}},g.map(function(e,t){return m.a.createElement("div",{key:t,style:{display:"flex",marginBottom:"5px"}},m.a.createElement("input",{type:"text",value:e,onChange:function(e){return function(e,t){var n=Object(r.a)(g);n[e]=t,v(n)}(t,e.target.value)},style:{flex:1,padding:"5px",fontFamily:"monospace"},placeholder:"Enter command (e.g., Open(LOX.Vent))"}),m.a.createElement("button",{onClick:function(){return function(e){g.length<=1?v([""]):v(g.filter(function(t,n){return n!==e}))}(t)},style:{marginLeft:"5px",padding:"5px",backgroundColor:"#ff9999"}},"X"))})),m.a.createElement("button",{onClick:function(){v([].concat(Object(r.a)(g),[""]))},style:{padding:"5px 10px",backgroundColor:"#2196f3",color:"white",border:"none",cursor:"pointer"}},"Add Command")):m.a.createElement(ae.a,{stickyHeader:!0,"aria-label":"simple table",style:{tableLayout:"fixed"}},m.a.createElement(re.a,null,m.a.createElement(te.a,null,m.a.createElement(ne.a,{align:"right",style:{width:100}},"Command"),m.a.createElement(ne.a,null,"Parameter"),m.a.createElement(ne.a,{align:"right"},!x&&m.a.createElement(m.a.Fragment,null,k&&m.a.createElement("button",{onClick:function(){return n("PAUSESEQUENCE",null)},style:{fontSize:"12px",padding:"3px 6px"}},"Pause"),(b.length||k)&&m.a.createElement("button",{onClick:function(){return n("UNSETSEQUENCE",null)},style:{fontSize:"12px",padding:"3px 6px",marginLeft:"5px"}},"Clear"))))),m.a.createElement(ie.a,null,k&&m.a.createElement(ce,Object.assign({inFlight:!0},k)),b.map(function(e,t){return m.a.createElement(ce,Object.assign({key:t},e))}))))))}var he=n(15);function me(e,t,n,a){return 14.504*((e/120-n/1e3)/(a/1e3)*t)}function fe(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(e-a)/((arguments.length>4&&void 0!==arguments[4]?arguments[4]:5)-a)*(n-t)+t;return Math.max(0,r)}var de={eth_tank:{barMax:100,zero:3.99,span:16.02},lox_tank:{barMax:100,zero:3.99,span:16.04},eth_n2:{barMax:250,zero:4,span:16},lox_n2:{barMax:250,zero:4,span:16},lox_cryo:{minFlow:.8,maxFlow:29,minVolts:0,maxVolts:5,type:"flow",kFactor:1686.8699,serialNumber:"130228-06"}},pe=20;function ye(e,t){return 14.504*(t/2.4*(e-.48))}var ge={time:NaN,"LOX Tank":NaN,"LOX N2":NaN,"ETH Tank":NaN,"ETH N2":NaN};function ve(e){return 26*e}function be(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=e.enabled;return Object(a.a)({position:"absolute",borderStyle:"solid",borderColor:"transparent",width:ve(r),height:ve(i),top:ve(n),left:ve(t)},o?{}:{cursor:"help"})}function ke(e){var t=e.state,n=e.emit,a=Object(p.a)(e,["state","emit"]),r=null!==t.data&&t.data.labjacks[a.test_stand].digital[a.labjack_pin],i=be(a);return m.a.createElement("div",null,t.data&&m.a.createElement("div",{style:i,title:a.enabled?"":"Please enable the arming and manual control switches to toggle"},m.a.createElement(v.a,{checked:r,onChange:function(){return t.data.labjacks[a.test_stand].digital[a.labjack_pin]?n("CLOSE",{name:a.test_stand,pin:parseInt(a.labjack_pin)}):n("OPEN",{name:a.test_stand,pin:parseInt(a.labjack_pin)})},disabled:!a.enabled}),m.a.createElement("label",{className:(r?"active":"inactive")+" control-label "+(a.enabled?"":"disabled")},m.a.createElement("br",null))))}function Ee(e){var t=e.state,n=(e.emit,e.sensorBatches,e.sensorAverages),r=e.updateSensorHistory,i=Object(p.a)(e,["state","emit","sensorBatches","sensorAverages","updateSensorHistory"]),o=be(Object(a.a)({enabled:!0},i)),l=null,s=null,c="",u="".concat(i.test_stand,"_").concat(i.labjack_pin),f=null;if(t.data){l=t.data.labjacks[i.test_stand].analog[i.labjack_pin];var d=de[i.sensorName];d&&("flow"===d.type?(f=fe(l,d.minFlow,d.maxFlow,d.minVolts,d.maxVolts),c="GPM"):(f=me(l,d.barMax,d.zero,d.span),c="PSI"))}Object(h.useEffect)(function(){null===f||void 0===f||isNaN(f)||r(u,f)},[f,u,r]);var y=n[u];if(s=y?y.value:f,t.data&&de[i.sensorName]){var g=de[i.sensorName];if("flow"===g.type)s>g.minFlow+.1&&(o.backgroundColor="lightgreen");else{s&&s>29.3918&&(o.backgroundColor="rgba(255, 99, 71, 0.7)")}}return m.a.createElement("div",{style:o},null!==s&&m.a.createElement("div",{className:"sensor-value-display"},s.toFixed(1)," ",c),l&&m.a.createElement("div",{className:"sensor-voltage-display"},"(",l.toFixed(2),"V)"))}function xe(e){var t=e.state,n=e.emit,i=Object(h.useState)({}),o=Object(_.a)(i,2),l=o[0],s=o[1],c=Object(h.useState)({}),u=Object(_.a)(c,2),f=u[0],d=u[1],p=Object(h.useCallback)(function(e,t){null===t||void 0===t||isNaN(t)||s(function(n){var i=n[e]||[],o=[].concat(Object(r.a)(i),[t]);if(o.length>=pe){var l=o.reduce(function(e,t){return e+t},0)/o.length;return d(function(t){return Object(a.a)({},t,Object(he.a)({},e,{value:l,count:o.length}))}),Object(a.a)({},n,Object(he.a)({},e,[]))}return Object(a.a)({},n,Object(he.a)({},e,o))})},[]);return m.a.createElement(E,{title:"Control Panel",className:"panel control",style:{height:"650px",overflow:"hidden",width:"790px"}},m.a.createElement("div",{className:"control-panel"},U.buttons.map(function(e){return t.data&&m.a.createElement(ke,Object.assign({title:e.pin.test_stand.charAt(0)+" "+e.pin.abbrev,key:e.pin.name,state:t,emit:n},e.pin,e.position,{enabled:t.data&&t.data.arming_switch&&t.data.manual_switch}))}),U.sensors.map(function(e){return t.data&&m.a.createElement(Ee,Object.assign({title:e.pin.abbrev,key:e.pin.name,state:t,emit:n},e.pin,e.position,{sensorName:e.pin.abbrev,sensorBatches:l,sensorAverages:f,updateSensorHistory:p}))})))}var we=n(88),Oe=n(87),je=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).state={data:null,mostRecentWarning:{},showWarning:!1,wsAddress:localStorage.getItem("wsaddr")||"192.168.0.5",defaultWSAddress:"192.168.0.5",events:[],socketStatus:-1},n.emit=n.emit.bind(Object(u.a)(Object(u.a)(n))),n.connect(),n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval(function(){return e.emit("PING")},200),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1,clearInterval(this.interval)}},{key:"pushWarning",value:function(e,t){(!this.state.mostRecentWarning||this.state.mostRecentWarning.time!==e&&this.state.mostRecentWarning.message!==t)&&this.setState({mostRecentWarning:{time:e,message:t},showWarning:!0})}},{key:"updateSocketStatus",value:function(){if(this.socket){var e={socketStatus:this.socket.readyState};this.socket.readyState!==WebSocket.OPEN&&this.pushWarning((new Date).getTime(),"Server connection lost"),this.setState(e)}}},{key:"connect",value:function(){var e=this;this.socket&&this.socket.close();try{this.socket=new WebSocket("ws://".concat(this.state.wsAddress,":8888")),this.updateSocketStatus(),this.socket.onopen=function(t){console.log("websocket connection established"),e.updateSocketStatus()},this.socket.onclose=function(t){e.updateSocketStatus(),e.socket=null,console.log("websocket connection lost. reconnecting..."),K(ge),setTimeout(function(){e.socket||e.connect()},1e3)},this.socket.onmessage=function(t){if(e.mounted){e.updateSocketStatus();var n,i,o=JSON.parse(t.data);switch(o.type){case"STATE":o.data.time=parseInt(o.data.time)/1e3;var l=V(function(){return e.state.data.time});o.data.time-l>1&&K(ge),K({time:(i=o.data).time,"LOX Tank":me(i.labjacks.LOX.analog[4],de.lox_tank.barMax,de.lox_tank.zero,de.lox_tank.span),"LOX N2":ye(i.labjacks.LOX.analog[5],250),"ETH Tank":me(i.labjacks.ETH.analog[4],de.eth_tank.barMax,de.eth_tank.zero,de.eth_tank.span),"ETH N2":ye(i.labjacks.ETH.analog[5],250),"LOX Flow":fe(i.labjacks.LOX.analog[2],de.lox_cryo.minFlow,de.lox_cryo.maxFlow)}),e.setState({data:o.data}),o.data.latest_warning&&e.pushWarning(o.data.latest_warning[0],o.data.latest_warning[1]);break;case"PING":e.setState({ping:(new Date).getTime()-o.data});break;case"VALVE":var s=o.time/1e3,c=Q(o.data.pin).pin,u=("CLOSE"===o.data.header?"Closed":"Opened")+" "+c.test_stand+" "+c.abbrev;n={time:s,label:u},document.dispatchEvent(new CustomEvent("datalogger-new-event",{detail:n})),e.setState({events:[].concat(Object(r.a)(e.state.events),[Object(a.a)({},o.data,{label:u,time:s})])});break;default:console.error(o)}}}}catch(t){console.error(t)}}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({header:e,data:t,time:(new Date).getTime()}))}},{key:"render",value:function(){var e=this;return m.a.createElement("div",null,m.a.createElement(k,null),m.a.createElement("div",{className:"panels-root"},m.a.createElement("div",{className:"panel-row-1"},m.a.createElement(M,{state:this.state,emit:this.emit,sockStatus:this.state.socketStatus,that:this}),m.a.createElement(ue,{state:this.state,emit:this.emit})),m.a.createElement("div",{className:"panel-row-2"},m.a.createElement(xe,{state:this.state,emit:this.emit}),m.a.createElement(Z,{state:this.state,emit:this.emit})),this.state.showWarning&&m.a.createElement(we.a,{open:!0,onClose:function(){return e.setState({showWarning:!1})},message:this.state.mostRecentWarning.message,action:m.a.createElement(Oe.a,{onClick:function(){return e.setState({showWarning:!1})},style:{color:"white",textTransform:"none",textDecoration:"underline"}},"Dismiss")})))}}]),t}(m.a.Component);d.a.render(m.a.createElement(m.a.StrictMode,null,m.a.createElement(je,null)),document.getElementById("root"))}},[[52,2,1]]]);
//# sourceMappingURL=main.0fb90197.chunk.js.map