(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(t){t.exports={notice:"The labjack pin values are duplicated in the Python code, beware!",buttons:[{pin:{test_stand:"ETH",labjack_pin:15,full_name:"Main Fuel (Ethanol) Valve",abbrev:"main",name:"ETH Main"},position:{width:2,height:1,x:11.5,y:15}},{pin:{test_stand:"ETH",labjack_pin:16,full_name:"Fuel (Ethanol) Fill Valve",abbrev:"fill",name:"ETH Fill"},position:{width:2,height:1,x:8,y:13}},{pin:{test_stand:"ETH",labjack_pin:17,full_name:"Fuel (Ethanol) Dump/Drain Valve",abbrev:"drain",name:"ETH Drain"},position:{width:2,height:1,x:4,y:13}},{pin:{test_stand:"ETH",labjack_pin:8,full_name:"Fuel (Ethanol) Tank Nitrogen Pressurisation Valve",abbrev:"pres",name:"ETH Pressurisation"},position:{width:2,height:1,x:8,y:4}},{pin:{test_stand:"ETH",labjack_pin:9,full_name:"Fuel (Ethanol) Tank Vent Valve",abbrev:"vent",name:"ETH Vent"},position:{width:2,height:1,x:11,y:1}},{pin:{test_stand:"ETH",labjack_pin:14,full_name:"Fuel (Ethanol) Line Nitrogen Purge Valve",abbrev:"purge",name:"ETH Purge"},position:{width:2,height:1,x:8,y:17}},{pin:{test_stand:"LOX",labjack_pin:14,full_name:"Main Oxidiser (LOX) Valve",abbrev:"main",name:"LOX Main"},position:{width:2,height:1,x:17.5,y:15}},{pin:{test_stand:"LOX",labjack_pin:16,full_name:"Oxidiser (LOX) Fill Valve",abbrev:"fill",name:"LOX Fill"},position:{width:2,height:1,x:21,y:13}},{pin:{test_stand:"LOX",labjack_pin:17,full_name:"Oxidiser (LOX) Dump/Drain Valve",abbrev:"drain",name:"LOX Drain"},position:{width:2,height:1,x:25,y:13}},{pin:{test_stand:"LOX",labjack_pin:9,full_name:"Oxidiser (LOX) Tank Nitrogen Pressurisation Valve",abbrev:"pres",name:"LOX Pressurisation"},position:{width:2,height:1,x:21,y:4}},{pin:{test_stand:"LOX",labjack_pin:10,full_name:"Oxidiser (LOX) Tank Vent Valve",abbrev:"vent",name:"LOX Vent"},position:{width:2,height:1,x:18,y:1}},{pin:{test_stand:"LOX",labjack_pin:8,full_name:"Oxidiser (LOX) Line Nitrogen Purge Valve",abbrev:"purge",name:"LOX Purge"},position:{width:2,height:1,x:21,y:17}},{pin:{test_stand:"LOX",labjack_pin:15,full_name:"Oxidiser (LOX) Line Nitrogen Chill Valve",abbrev:"chill",name:"LOX Chill"},position:{width:2,height:1,x:25,y:17}}],sensors:[{pin:{test_stand:"LOX",labjack_pin:5,sensorNumber:0,full_name:"LOX Nitrogen Pressurant Sensor",abbrev:"lox_n2"},position:{width:5,height:3,x:25,y:3}},{pin:{test_stand:"LOX",labjack_pin:4,sensorNumber:1,full_name:"LOX Tank Pressure Sensor",abbrev:"lox_tank"},position:{width:3,height:4.5,x:17,y:7.5}},{pin:{test_stand:"ETH",labjack_pin:5,sensorNumber:2,full_name:"Ethanol Nitrogen Pressurant Sensor",abbrev:"eth_n2"},position:{width:5,height:3,x:1,y:3}},{pin:{test_stand:"ETH",labjack_pin:4,sensorNumber:3,full_name:"Ethanol Tank Pressure Sensor",abbrev:"eth_tank"},position:{width:3,height:4.5,x:11,y:7.5}},{pin:{test_stand:"LOX",labjack_pin:2,sensorNumber:4,full_name:"Cryogenic Flow Sensor",abbrev:"lox_cryo"},position:{width:5,height:3,x:25,y:8}}]}},51:function(t,e,n){t.exports=n(60)},56:function(t,e,n){},60:function(t,e,n){"use strict";n.r(e);var a=n(11),r=n(8),i=n(16),o=n(17),l=n(32),s=n(28),c=n(33),u=n(27),h=n(0),m=n.n(h),f=n(13),d=n.n(f),p=(n(56),n(21)),y=n(78),g=n(6),v=n(88);function b(t){var e=t.children;return m.a.createElement("div",{style:{width:"100%",padding:"6px",height:"40px"}},m.a.createElement("h1",null,e))}function k(){return m.a.createElement("div",{className:"top-bar"},m.a.createElement("img",{src:"./logo.png",alt:"logo"}),m.a.createElement("h1",null,"Test Stand Control Panel"))}function E(t){var e=t.children,n=t.title,a=Object(p.a)(t,["children","title"]);return m.a.createElement("div",Object.assign({className:"panel"},a),m.a.createElement(b,null,n),m.a.createElement(y.a,{style:{width:"100%",height:"calc(100% - 52px"}},e))}var x=Object(g.a)(function(t){return{root:{width:60,height:32,padding:1,display:"flex",overflow:"visible"},switchBase:{padding:2,color:t.palette.grey[500],"&$checked":{transform:"translateX(26px)",color:t.palette.common.white,"& + $track":{opacity:1,backgroundColor:t.palette.primary.main,borderColor:t.palette.primary.main}}},thumb:{marginLeft:1,marginTop:1,width:28,height:28,boxShadow:"none"},track:{border:"1px solid ".concat(t.palette.grey[500]),borderRadius:8,opacity:1,backgroundColor:t.palette.common.white},checked:{}}})(v.a);Object(g.a)(function(t){return{root:{position:"absolute",top:"-10px",left:"-10px",width:"6vw"}}})(v.a);function w(t){var e=t.value,n=t.setValue;return m.a.createElement("div",{className:"toggle-switch",style:{width:60}},m.a.createElement("span",{className:e?"inactive":"active"},"Off"),m.a.createElement(x,{checked:e,onChange:function(){return n(!e)}}),m.a.createElement("span",{className:e?"active":"inactive",style:{textAlign:"right",width:"100%",display:"block"}},"On"))}function O(t){var e="";e=t.children?t.children:m.a.createElement(w,{value:t.switchValue,setValue:t.setSwitchValue});var n=t.label?{cursor:"help",borderBottom:"1px dotted #333"}:{};return m.a.createElement("div",{className:"safety-card"},m.a.createElement("h2",{title:t.label,style:Object(a.a)({},n,t.style||{})},t.title),e)}var j={LINE_POWERED:"\u2705",BATTERY_POWERED:"\ud83d\udd0b",UNKNOWN:"\u2754"},S={LINE_POWERED:"Powered",BATTERY_POWERED:"Battery",UNKNOWN:"Unknown"};function _(t){var e=t.state,n=t.emit,a=t.sockStatus,r=t.that,i=null!==e.data&&e.data.arming_switch,o=null!==e.data&&e.data.manual_switch,l=null!==e.data&&e.data.data_logging,s=null===e.data?"UNKNOWN":e.data.UPS_status,c=j[s]+" "+S[s],u=a===WebSocket.OPEN?m.a.createElement("div",{style:{color:"green"}},"Connected"):m.a.createElement("div",{style:{color:"red"}}," Disconnected");return m.a.createElement(E,{title:"Safety",className:"panel safety"},m.a.createElement("div",{className:"flex",style:{justifyContent:"flex-start"}},m.a.createElement(O,{title:"Arming",label:"Controls if the state can change",isButton:"false",switchValue:i,setSwitchValue:function(t){return n("ARMINGSWITCH",t)}}),m.a.createElement(O,{title:"Manual",label:"Allow manual pin operation",isButton:"false",switchValue:o,setSwitchValue:function(t){return n("MANUALSWITCH",t)}}),m.a.createElement(O,{title:"Logging",label:"Logging data",isButton:"false",switchValue:l,setSwitchValue:function(t){return n("DATALOG",t)}}),m.a.createElement(O,{title:"Server IP",label:"Local IP address of the Raspberry Pi. Must be on the same network. If it's incorrect no new data will appear"},m.a.createElement("input",{value:e.wsAddress,size:"10",onChange:function(t){r.setState({wsAddress:t.target.value},function(){localStorage.setItem("wsaddr",t.target.value),r.connect()})},placeholder:e.defaultWSAddress})),m.a.createElement(O,{title:"Ping",label:"Time delay to reach the server",style:{width:40}},e.ping?e.ping:"0","ms"),m.a.createElement("div",{style:{paddingTop:6}},m.a.createElement(O,{title:"Status"},u),s&&m.a.createElement(O,{title:"UPS"},c))))}var M=n(9),L=n(34);function N(t,e){return parseFloat(t.toPrecision(e))}function T(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;if(0===t)return"0 "+e;for(var a=[["T",4],["G",3],["M",2],["K",1],["",0],["m",-1],["\u03bc",-2],["n",-3]],r=0;r<a.length;r++){var i=Math.pow(1e3,a[r][1]);if(Math.abs(t)>=i)return N(t/i,n)+" "+a[r][0]+e}return N(t/Math.pow(1e3,-4),n)+" p"+e}function C(t,e,n,a){for(var r=function t(e){if(e<0)return t(-e);if(0===e)return 0;var n=-Math.floor(Math.log10(e)),a=Math.log10(e)+n,r=[0,Math.log10(2),Math.log10(5),1],i=r[0],o=r[1],l=r[2],s=r[3],c=[Math.abs(a-i),Math.abs(a-o),Math.abs(a-l),Math.abs(a-s)],u=Math.min.apply(Math,c);return(u===c[0]?1:u===c[1]?2:u===c[2]?5:10)*Math.pow(10,-n)}((e-t)/n),i=[],o=Math.ceil(t/r)*r,l=Math.floor(e/r)*r,s=o;s<=l;s+=r)Math.abs(s)<1e-10&&(s=0),i.push({tick:s,label:T(s,a)});return i}function P(t,e,n){for(var a,r=0,i=n-1;r<=i;){var o=t(a=Math.floor((r+i)/2));if(o===e)return a;o<e?r=a+1:i=a-1}return i}function A(t,e){return t?e?[Math.min(t[0],e[0]),Math.max(t[1],e[1])]:t:e}function X(t,e){var n=Object(M.a)(t,2);return function(t,e){var n=Object(M.a)(t,2),a=n[0],r=n[1],i=Object(M.a)(e,2);return[a+(r-a)*i[0],r-(r-a)*(1-i[1])]}([n[0],n[1]],[-e,1+e])}function F(t,e,n){return Math.max(e,Math.min(n,t))}function V(t){var e;try{e=t()}catch(n){if(!(n instanceof TypeError))throw n;e=void 0}return e}var W=function(){function t(e){Object(i.a)(this,t),this.capacity=e,this.array=new Float64Array(this.capacity),this.size=0,this.chunks=0}return Object(o.a)(t,[{key:"push",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];try{this.array.set(e,this.size),this.size+=e.length,this.chunks++}catch(a){console.error(this,e),console.error(a)}}},{key:"shrink",value:function(){var t=new Float64Array(this.size);t.set(this.array.subarray(0,this.size)),this.array=t}},{key:"filterMapChunks",value:function(t,e){for(var n=[],a=0;a<this.chunks;a++)t(a)&&n.push(e(a));return n}}]),t}(),I=function(t){function e(t){return Object(i.a)(this,e),Object(l.a)(this,Object(s.a)(e).call(this,4*t))}return Object(c.a)(e,t),Object(o.a)(e,[{key:"time",value:function(t){return this.array[4*t]}},{key:"mean",value:function(t){return this.array[4*t+1]}},{key:"min",value:function(t){return this.array[4*t+2]}},{key:"max",value:function(t){return this.array[4*t+3]}},{key:"updateDecimation",value:function(t){var e=t.chunks;this.chunks=Math.ceil(e/2),this.size=4*this.chunks;var n=this.size;if(0!==e)switch(e%2){case 0:this.array[n-4]=t.time(e-1),this.array[n-3]=(t.mean(e-2)+t.mean(e-1))/2,this.array[n-2]=Math.min(t.min(e-2),t.min(e-1)),this.array[n-1]=Math.max(t.max(e-2),t.max(e-1));break;case 1:this.array[n-4]=t.time(e-1),this.array[n-3]=t.mean(e-1),this.array[n-2]=t.min(e-1),this.array[n-1]=t.max(e-1)}}}]),e}(W),H=function(t){function e(t){return Object(i.a)(this,e),Object(l.a)(this,Object(s.a)(e).call(this,2*t))}return Object(c.a)(e,t),Object(o.a)(e,[{key:"time",value:function(t){return this.array[2*t+0]}},{key:"mean",value:function(t){return this.array[2*t+1]}},{key:"min",value:function(t){return this.array[2*t+1]}},{key:"max",value:function(t){return this.array[2*t+1]}}]),e}(W),B=function(){function t(){Object(i.a)(this,t),this.n_bound=12,this.capacity=524288,this.arrays={},this.arrays[0]=new H(this.capacity);for(var e=1;e<=this.n_bound;e++)this.arrays[e]=new I(this.capacity>>e)}return Object(o.a)(t,[{key:"push",value:function(t,e){this.arrays[0].push(t,e);for(var n=1;n<=this.n_bound;n++)this.arrays[n].updateDecimation(this.arrays[n-1])}},{key:"sample",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,r=[Math.max(P(function(t){return n.arrays[0].time(t)},t,this.arrays[0].chunks),0),Math.min(P(function(t){return n.arrays[0].time(t)},e,this.arrays[0].chunks)+2,this.arrays[0].chunks)],i=r[1]-r[0],o=Math.min(this.n_bound,Math.max(0,1+Math.floor(Math.log(i/a+.01)/Math.log(2))))||0,l=[Math.max(P(function(t){return n.arrays[o].time(t)},t,this.arrays[o].chunks),0),Math.min(P(function(t){return n.arrays[o].time(t)},e,this.arrays[o].chunks)+2,this.arrays[o].chunks)],s=l[1]-l[0],c=new Array(s);c.min=1/0,c.max=-1/0;for(var u=0;u<s;u++)c[u]=[this.arrays[o].time(l[0]+u),this.arrays[o].mean(l[0]+u),this.arrays[o].min(l[0]+u),this.arrays[o].max(l[0]+u)],c.min=Math.min(c.min,c[u][2]),c.max=Math.max(c.max,c[u][3]);return c.decimated=o>0,c.getPoints=function(t,e,n){for(var a="",r=0;r<s;r++)a+="".concat(t(c[r][0]-n).toFixed(1),",").concat(Math.round(e(c[r][1]))," ");return a},c.getMinMaxPoints=function(t,e,n){for(var a="",r=0;r<s;r++)a+="".concat(t(c[r][0]-n).toFixed(1),",").concat(Math.round(e(c[r][2]))," ");for(var i=s-1;i>=0;i--)a+="".concat(t(c[i][0]-n).toFixed(1),",").concat(Math.round(e(c[i][3]))," ");return a},c}},{key:"samplePreview",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,n=this.arrays[0].chunks,a=Math.ceil(n/e),r=1/0,i=-1/0,o=this.arrays[0].filterMapChunks(function(t){return t%a===0||t===n-1},function(e){var n=t.arrays[0].mean(e);return r=Math.min(r,n),i=Math.max(i,n),[t.arrays[0].time(e),n]});return o.min=r,o.max=i,o.getPoints=function(t,e,n){for(var a="",r=0;r<o.length;r++)a+="".concat(t(o[r][0]-n).toFixed(1),",").concat(Math.round(e(o[r][1]))," ");return a},o}},{key:"shrink",value:function(){for(var t=0;t<=this.n_bound;t++)this.arrays[t].shrink()}}]),t}(),z=function(){function t(){Object(i.a)(this,t),this.series=[new B],this.enabled=!0}return Object(o.a)(t,[{key:"push",value:function(t,e){isNaN(t)||isNaN(e)?this.series[this.series.length-1].arrays[0].chunks>0&&(this.series[this.series.length-1].shrink(),this.series.push(new B)):this.series[this.series.length-1].push(t,e)}},{key:"sample",value:function(t,e,n){var a=this.series.map(function(a){return a.sample(t,e,n)});return a.totalLength=a.reduce(function(t,e){return t+e.length},0),a.splitPointIndex=function(t){for(var e=0;e<a.length;e++){if(t<a[e].length)return[e,t];if((t-=a[e].length)<0)return[-1,-1]}},a.fromPointIndex=function(t){var e=a.splitPointIndex(t),n=Object(M.a)(e,2),r=n[0],i=n[1];return a[r][i]},a.min=Math.min.apply(Math,Object(r.a)(a.map(function(t){return t.min}))),a.max=Math.max.apply(Math,Object(r.a)(a.map(function(t){return t.max}))),a}},{key:"samplePreview",value:function(t){if(0===this.series.length||0===this.series[0].arrays[0].chunks)return[];var e=[this.minTime(),this.maxTime()];if(e[0]===e[1])return[];var n=this.series.filter(function(t){return t.arrays[0].chunks}).map(function(n){var a=(n.arrays[0].time(n.arrays[0].chunks-1)-n.arrays[0].time(0))/(e[1]-e[0]);return n.samplePreview(t*a)});return n.min=Math.min.apply(Math,Object(r.a)(n.map(function(t){return t.min}))),n.max=Math.max.apply(Math,Object(r.a)(n.map(function(t){return t.max}))),n}},{key:"minTime",value:function(){var t=this;return V(function(){return t.series[0].arrays[0].time(0)})}},{key:"maxTime",value:function(){for(var t=this.series.length-1;t>=0;t--)if(this.series[t].arrays[0].chunks>0)return this.series[t].arrays[0].time(this.series[t].arrays[0].chunks-1);return NaN}}]),t}(),R=function(){function t(e){Object(i.a)(this,t),this.series=e,this.keys=Array.from(Object.keys(this.series)),this.arrays=this.objectMap(function(t){return new z})}return Object(o.a)(t,[{key:"objectMap",value:function(t){return this.keys.reduce(function(e,n){return e[n]=t(n),e},{})}},{key:"minTime",value:function(){var t=this;return Math.min.apply(Math,Object(r.a)(this.keys.map(function(e){return t.arrays[e].minTime()}).filter(function(t){return t})))}},{key:"sample",value:function(t,e){var n=this,a=this.objectMap(function(a){var i;return n.arrays[a].enabled&&(i=n.arrays[a]).sample.apply(i,Object(r.a)(t).concat([e]))});return a.min=Math.min.apply(Math,Object(r.a)(this.keys.filter(function(t){return n.arrays[t].enabled}).map(function(t){return a[t].min}))),a.max=Math.max.apply(Math,Object(r.a)(this.keys.filter(function(t){return n.arrays[t].enabled}).map(function(t){return a[t].max}))),a}},{key:"samplePreview",value:function(t){var e=this,n=this.objectMap(function(n){return e.arrays[n].enabled&&e.arrays[n].samplePreview(t)});return n.min=Math.min.apply(Math,Object(r.a)(this.keys.filter(function(t){return e.arrays[t].enabled}).map(function(t){return n[t].min}))),n.max=Math.max.apply(Math,Object(r.a)(this.keys.filter(function(t){return e.arrays[t].enabled}).map(function(t){return n[t].max}))),n}},{key:"toggleSeries",value:function(t){this.arrays[t].enabled=!this.arrays[t].enabled}}]),t}(),D=n(25);function U(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=D.buttons.filter(function(n){return n.pin.labjack_pin===t&&n.pin.test_stand===e})[0];if(n)return n}return D.buttons.filter(function(e){return e.pin.labjack_pin===t})[0]}window.enablePageScroll=L.enablePageScroll,window.disablePageScroll=L.disablePageScroll;var Y=function(t){return document.dispatchEvent(new CustomEvent("datalogger-new-data",{detail:t}))};function Q(t){var e=t.series,n=t.unit,i=t.label,o=t.yBoundsRef,l=t.minYBounds,s=Array.from(Object.keys(e)),c=new R(e),u=[],h=function(){},f=function(){return requestAnimationFrame(h)};return document.addEventListener("datalogger-new-data",function(t){var e,n=t.detail,a=U(s);try{for(a.s();!(e=a.n()).done;){var r=e.value;r in n&&c.arrays[r].push(n.time,n[r])}}catch(i){a.e(i)}finally{a.f()}f()}),document.addEventListener("datalogger-new-event",function(t){var e=t.detail;u.push(Object(a.a)({},e,{key:u.length})),f()}),function(t){var f=t.currentSeconds,d=m.a.useRef(null);h=m.a.useReducer(function(t){return t+1},0)[1];var y=600,g=250;f||(f=(new Date).getTime()/1e3);var v,b,k,E=c.minTime(),x=m.a.useState([-3]),w=Object(M.a)(x,2),O=w[0],j=w[1],S=function(t){if(1===t.length||t[1]>=f){var e=1===t.length?t[0]:t[0]-f,n=Math.min(-10,E-f);j([F(e,n,0)])}else t=[Math.min.apply(Math,Object(r.a)(t)),Math.max.apply(Math,Object(r.a)(t))],j([F(t[0],E,t[1]-.01),F(t[1],t[0],f)])},_=1===O.length?[f+O[0],f]:O,N=[_[0]-f,_[1]-f],W=c.sample(_,y);o.current=(v=o.current,b=A([W.min,W.max],l),k=.1,v?b?[v[0]+(b[0]-v[0])*k,v[1]+(b[1]-v[1])*k]:v:b);var I=X(o.current,.2),H=[E,f],B=1,z=1,R=1,D=1,U=function(t){return B+t*(y-B-z)},G=function(t){return R+t*(g-R-D)},q=function(t){return U((t-N[0])/(N[1]-N[0]))},Y=function(t){return G(1-(t-I[0])/(I[1]-I[0]))},Q=function(t){return N[0]+function(t){return(t-B)/(y-B-z)}(t)*(N[1]-N[0])},J=C.apply(void 0,N.concat([4,"s"])),K=C.apply(void 0,Object(r.a)(I).concat([4,n])),$=m.a.useState(null),Z=Object(M.a)($,2),tt=Z[0],et=Z[1],nt=s.map(function(t){if(!W[t]||!W[t].length)return null;var e=P(function(e){return W[t].fromPointIndex(e)[0]},f+Q(tt),W[t].totalLength-1);if(-1===e)return null;var n=W[t].splitPointIndex(e),a=Object(M.a)(n,2),r=a[0],i=a[1];return i>=W[t][r].length-1||r<0||i<0?null:[r,i]}).map(function(t,e){if(null===t)return"";var a,r,i,o,l,c=Object(M.a)(t,2),u=c[0],h=c[1],m=W[s[e]],d=(a=m[u][h][0],r=m[u][h][1],i=m[u][h+1][0],o=m[u][h+1][1],l=f+Q(tt),r+(o-r)*(l-a)/(i-a));return"".concat(s[e],": ").concat(T(d,n))}).filter(function(t){return t.length}),at=tt>U(1)-200,rt=m.a.useState(!1),it=Object(M.a)(rt,2),ot=it[0],lt=it[1],st=m.a.useState(null),ct=Object(M.a)(st,2),ut=ct[0],ht=ct[1],mt=function(t){return t.clientX-V(function(){return d.current.getBoundingClientRect().left})},ft=u.map(function(t){var e=t.time,n=Object(p.a)(t,["time"]);return Object(a.a)({x:q(e-f)},n)}).filter(function(t){var e=t.x;return e>=U(0)-10&&e<=U(1)}),dt=_[1]-_[0]<15;return m.a.createElement("div",{style:{marginBottom:"10px"}},m.a.createElement("h4",{style:{margin:"5px 0",fontSize:"14px"}},i),m.a.createElement("svg",{viewBox:"0 0 ".concat(y," ").concat(g),xmlns:"http://www.w3.org/2000/svg",width:y,height:g,style:{userSelect:"none",fontFamily:"sans-serif",display:"block"},ref:d,onMouseOver:function(){return Object(L.disablePageScroll)()},onMouseOut:function(t){var e=d.current.getBoundingClientRect();Object(L.enablePageScroll)(),(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)&&et(null)},onMouseDown:function(t){lt(!0),ht([mt(t),_])},onWheel:function(t){var e=t.deltaX+t.deltaY,n=1===O.length?_[1]:tt?f+Q(tt):(_[0]+_[1])/2,a=Math.max(n+(_[0]-n)*Math.pow(1.001,e),Math.min(H[0]+.01,f-10)),r=Math.min(n+(_[1]-n)*Math.pow(1.001,e),H[1]);S([Math.min(a,r-.01),r])},onMouseMove:function(t){var e=mt(t);if(et(e),ot){var n=Object(M.a)(ut,2),a=n[0],r=n[1],i=Q(a)-Q(e),o=[r[0]+i,r[1]+i];o=function(t,e){var n=Object(M.a)(t,2),a=n[0],r=n[1],i=Object(M.a)(e,2),o=i[0],l=i[1];return a<o&&r>l?[o,l]:a<o?[o,o+(r-a)]:r>l?[l-(r-a),l]:[a,r]}(o,A(H,[f-10,f])),S(o)}}},J.map(function(t){var e=t.tick;return t.label,m.a.createElement("line",{key:e,x1:q(e),y1:G(1),x2:q(e),y2:G(0),stroke:"#ddd"})}),m.a.createElement("line",{x1:0,y1:G(1),x2:y,y2:G(1),stroke:"#888",strokeWidth:"2"}),K.map(function(t){var e=t.tick;return t.label,m.a.createElement("line",{key:e,x1:U(0),y1:Y(e),x2:U(1),y2:Y(e),stroke:"#ddd"})}),m.a.createElement("line",{x1:U(0),y1:0,x2:U(0),y2:g,stroke:"#888",strokeWidth:"2"}),ft.map(function(t,e){var n=t.x,a=t.label,r=t.key;return m.a.createElement("g",{key:r},m.a.createElement("line",{x1:n,y1:G(0),x2:n,y2:G(1),stroke:"#333",strokeWidth:"1",strokeDasharray:"2 4"}),dt&&m.a.createElement("text",{x:n+5,y:G(1)-e%10*12-20,textAnchor:"start",alignmentBaseline:"text-after-edge",fontSize:"12"},a))}),s.map(function(t){return m.a.createElement("g",{key:t},W[t]&&W[t].map(function(n,a){return n.length&&n.decimated&&m.a.createElement("polygon",{key:a,points:n.getMinMaxPoints(q,Y,f),fill:e[t].color,opacity:"0.5",stroke:"none",strokeWidth:"0"})}),W[t]&&W[t].map(function(n,a){return n.length&&m.a.createElement("polyline",{key:a,points:n.getPoints(q,Y,f),fill:"none",stroke:e[t].color,strokeWidth:"2"})}))}),J.map(function(t){var e=t.tick,n=t.label;return q(e)-U(0)>40&&m.a.createElement("text",{key:e,x:q(e),y:G(1)-2,textAnchor:"middle",alignmentBaseline:"after-edge",fontSize:"12"},n)}),K.map(function(t){var e=t.tick,n=t.label;return G(1)-Y(e)>20&&m.a.createElement("text",{key:e,x:U(0)+2,y:Y(e),textAnchor:"start",alignmentBaseline:"after-edge",fontSize:"12"},n)}),nt.length&&tt>U(0)&&m.a.createElement("g",null,m.a.createElement("line",{x1:tt,y1:G(0),x2:tt,y2:G(1),stroke:"black",strokeWidth:"1"}),nt.map(function(t,e){return m.a.createElement("text",{key:e,x:Math.max(50,Math.min(tt+(at?-5:5),U(1)-100)),y:G(0)+18+20*e,textAnchor:at?"end":"start",alignmentBaseline:"text-after-edge",fontSize:"12"},t)})),s.map(function(t,n){return m.a.createElement("g",{key:t,onClick:function(e){return c.toggleSeries(t)},cursor:"pointer"},m.a.createElement("rect",{x:500,y:20*n,width:"100",height:"20",fill:"transparent"}),m.a.createElement("circle",{r:"4",fill:c.arrays[t].enabled?e[t].color:"lightgrey",cx:590,cy:12+20*n}),m.a.createElement("text",{fontSize:"12",x:580,textAnchor:"end",alignmentBaseline:"middle",fill:c.arrays[t].enabled?e[t].color:"lightgrey",y:13+20*n},t))})),m.a.createElement("button",{onClick:function(){var t=d.current,e=(new XMLSerializer).serializeToString(t),n=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download="".concat(i.replace(/\s+/g,"_").toLowerCase(),"_graph.svg"),r.click()}},"Download SVG"))}}var J=Q({unit:"psi",label:"Pressure Sensors",yBoundsRef:{current:null},minYBounds:[-10,10],series:{"LOX Tank":{color:"#000"},"LOX N2":{color:"#f00"},"ETH Tank":{color:"#3d6"},"ETH N2":{color:"#09f"}}}),K=Q({unit:"GPM",label:"Flow Sensors",yBoundsRef:{current:null},minYBounds:[0,5],series:{"LOX Flow":{color:"#ff6600"}}});function $(t){var e=t.state;return m.a.createElement(E,{title:"Graphs",className:"panel graphs"},m.a.createElement(J,{currentSeconds:V(function(){return e.data.time})}),m.a.createElement(K,{currentSeconds:V(function(){return e.data.time})}))}var Z=n(45),tt=n(81),et=n(82),nt=n(83),at=n(84),rt=n(85);function it(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ot(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function lt(){lt=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(S){l=function(t,e,n){return t[e]=n}}function s(t,e,n,a){var r=e&&e.prototype instanceof h?e:h,i=Object.create(r.prototype),o=new w(a||[]);return i._invoke=function(t,e,n){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return j()}for(n.method=r,n.arg=i;;){var o=n.delegate;if(o){var l=k(o,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var s=c(t,e,n);if("normal"===s.type){if(a=n.done?"completed":"suspendedYield",s.arg===u)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(a="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(S){return{type:"throw",arg:S}}}t.wrap=s;var u={};function h(){}function m(){}function f(){}var d={};l(d,r,function(){return this});var p=Object.getPrototypeOf,y=p&&p(p(O([])));y&&y!==e&&n.call(y,r)&&(d=y);var g=f.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach(function(e){l(t,e,function(t){return this._invoke(e,t)})})}function b(t,e){var a;this._invoke=function(r,i){function o(){return new e(function(a,o){!function a(r,i,o,l){var s=c(t[r],t,i);if("throw"!==s.type){var u=s.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){a("next",t,o,l)},function(t){a("throw",t,o,l)}):e.resolve(h).then(function(t){u.value=t,o(u)},function(t){return a("throw",t,o,l)})}l(s.arg)}(r,i,a,o)})}return a=a?a.then(o,o):o()}}function k(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=c(n,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,u;var r=a.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function O(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function e(){for(;++a<t.length;)if(n.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return m.prototype=f,l(g,"constructor",f),l(f,"constructor",m),m.displayName=l(f,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,l(t,o,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),l(b.prototype,i,function(){return this}),t.AsyncIterator=b,t.async=function(e,n,a,r,i){void 0===i&&(i=Promise);var o=new b(s(e,n,a,r),i);return t.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},v(g),l(g,o,"Generator"),l(g,r,function(){return this}),l(g,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var a=e.pop();if(a in t)return n.value=a,n.done=!1,n}return n.done=!0,n}},t.values=O,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(n,a){return o.type="throw",o.arg=t,e.next=n,a&&(e.method="next",e.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var a=n.completion;if("throw"===a.type){var r=a.arg;x(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function st(t){return m.a.createElement(tt.a,{style:t.inFlight?{background:"#94F690"}:{}},m.a.createElement(et.a,{align:"right"},t.name[0]+t.name.substring(1).toLowerCase()),m.a.createElement(et.a,{colSpan:"2"},t.stand?function(){if(!t.stand)return null;var e=q(t.pin,t.stand);return e&&e.pin&&e.pin.name||"Unknown Pin ".concat(t.pin)}():((t.inFlight?t.remaining:t.ms)/1e3).toFixed(1)+"s"))}function ct(t){var e=t.state,n=t.emit,i=Object(h.useState)(""),o=Object(M.a)(i,2),l=o[0],s=o[1],c=Object(h.useState)(!1),u=Object(M.a)(c,2),f=u[0],d=u[1],p=Object(h.useState)([]),y=Object(M.a)(p,2),g=y[0],v=y[1],b=e.data&&e.data.current_sequence||[],k=null===e.data?null:e.data.command_in_flight,x=!!e.data&&3===e.data.status,w=b.length>0||null!==k,j=function(){var t=Object(Z.a)(lt().mark(function t(){var e;return lt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=prompt("Enter a sequence name like 'operation' (lowercase without quotes). (This loads from a sequence file in src/sequences on the server RPi)"))){t.next=5;break}return s(e),t.next=5,n("SETSEQUENCE",e);case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),S=function(t){try{if(!t||"object"!==typeof t)return"";if("Sleep"===t.name)return"Sleep(seconds=".concat((t.ms/1e3).toFixed(1),")");if("Open"===t.name||"Close"===t.name){if(!t.stand)return"";var e="Unknown";try{t.pin&&q(t.pin,t.stand)&&q(t.pin,t.stand).pin&&(e=q(t.pin,t.stand).pin.name)}catch(n){console.error("Error getting pin name:",n)}return"".concat(t.name,"(").concat(t.stand,".").concat(e,")")}return""}catch(n){return console.error("Error formatting command:",n),""}},_=e.data&&e.data.arming_switch,L={fontSize:"12px",padding:"5px 8px",marginBottom:"5px",width:"100%"};return m.a.createElement(E,{title:"Sequences"},m.a.createElement("div",{className:"flex"},m.a.createElement("div",{style:{width:"200px",borderRight:"1px solid #999",height:"100%"}},m.a.createElement("div",{className:"frame"},m.a.createElement("h2",{style:{fontSize:"16px",margin:"5px 0"}},"Start"),m.a.createElement("div",null,m.a.createElement("button",{onClick:j,disabled:!_||f,style:L},"Choose sequence")),m.a.createElement("button",{onClick:function(){return n("BEGINSEQUENCE",null)},style:Object(a.a)({},L,{backgroundColor:_&&!f?"lime":"lightgrey",cursor:_&&!f?"pointer":"default"}),disabled:!_||f},"Start"),m.a.createElement(O,{title:"Abort",style:{margin:"5px 0"}},m.a.createElement("button",{onClick:function(){return n("ABORTSEQUENCE",t);var t},style:Object(a.a)({},L,{backgroundColor:_&&!f?"tomato":"lightgrey",cursor:_&&!f?"pointer":"default"}),disabled:!_||f},"ABORT")),m.a.createElement("div",{style:{marginTop:"5px",marginBottom:"5px"}},f?m.a.createElement(m.a.Fragment,null,m.a.createElement("button",{onClick:function(){var t=g.filter(function(t){return t.trim()});n("SAVESEQUENCE",{name:l,commands:t}),d(!1),alert("Sequence saved!"),n("SETSEQUENCE",l)},style:Object(a.a)({},L,{backgroundColor:"lime",cursor:"pointer"})},"Save"),m.a.createElement("button",{onClick:function(){d(!1)},style:Object(a.a)({},L,{backgroundColor:"#ff9999",cursor:"pointer"})},"Cancel")):m.a.createElement("button",{onClick:function(){if(l||!w){console.log("Current sequences:",b),console.log("Current executing command:",k);var t=[];if(k)try{var e=S(k);e&&t.push(e)}catch(o){console.error("Error formatting executing command:",o)}if(b&&Array.isArray(b)){var n,a=it(b);try{for(a.s();!(n=a.n()).done;){var r=n.value;try{var i=S(r);i&&t.push(i)}catch(o){console.error("Error formatting sequence command:",o)}}}catch(s){a.e(s)}finally{a.f()}}0===t.length&&t.push("Close(ETH.Vent)","Close(LOX.Vent)","Sleep(seconds=5.0)","Open(ETH.Pressure)","Open(LOX.Pressure)","Sleep(seconds=15.0)","Open(ETH.Main)","Open(LOX.Main)","Sleep(seconds=10.0)","Close(ETH.Main)","Close(LOX.Main)","Open(ETH.Purge)","Open(LOX.Purge)","Close(ETH.Pressure)","Close(LOX.Pressure)","Open(ETH.Vent)","Open(LOX.Vent)","Sleep(seconds=3.0)","Close(ETH.Purge)","Close(LOX.Purge)"),console.log("Command strings for editor:",t),v(t),d(!0)}else alert("Please choose a sequence first using the 'Choose sequence' button")},disabled:!w||!_,style:Object(a.a)({},L,{backgroundColor:w&&_?"#2196f3":"lightgrey",color:"white",cursor:w&&_?"pointer":"default"})},"Edit")))),m.a.createElement("div",{style:{overflow:"auto",width:"100%",height:"100%"}},f?m.a.createElement("div",{style:{padding:"10px"}},m.a.createElement("h3",{style:{margin:"0 0 10px 0"}},"Editing Sequence: ",l),m.a.createElement("div",{style:{marginBottom:"10px"}},g.map(function(t,e){return m.a.createElement("div",{key:e,style:{display:"flex",marginBottom:"5px"}},m.a.createElement("input",{type:"text",value:t,onChange:function(t){return function(t,e){var n=Object(r.a)(g);n[t]=e,v(n)}(e,t.target.value)},style:{flex:1,padding:"5px",fontFamily:"monospace"},placeholder:"Enter command (e.g., Open(LOX.Vent))"}),m.a.createElement("button",{onClick:function(){return function(t){g.length<=1?v([""]):v(g.filter(function(e,n){return n!==t}))}(e)},style:{marginLeft:"5px",padding:"5px",backgroundColor:"#ff9999"}},"X"))})),m.a.createElement("button",{onClick:function(){v([].concat(Object(r.a)(g),[""]))},style:{padding:"5px 10px",backgroundColor:"#2196f3",color:"white",border:"none",cursor:"pointer"}},"Add Command")):m.a.createElement(nt.a,{stickyHeader:!0,"aria-label":"simple table",style:{tableLayout:"fixed"}},m.a.createElement(at.a,null,m.a.createElement(tt.a,null,m.a.createElement(et.a,{align:"right",style:{width:100}},"Command"),m.a.createElement(et.a,null,"Parameter"),m.a.createElement(et.a,{align:"right"},!x&&m.a.createElement(m.a.Fragment,null,k&&m.a.createElement("button",{onClick:function(){return n("PAUSESEQUENCE",null)},style:{fontSize:"12px",padding:"3px 6px"}},"Pause"),(b.length||k)&&m.a.createElement("button",{onClick:function(){return n("UNSETSEQUENCE",null)},style:{fontSize:"12px",padding:"3px 6px",marginLeft:"5px"}},"Clear"))))),m.a.createElement(rt.a,null,k&&m.a.createElement(st,Object.assign({inFlight:!0},k)),b.map(function(t,e){return m.a.createElement(st,Object.assign({key:e},t))}))))))}function ut(t,e,n,a){return 14.504*((t/120-n/1e3)/(a/1e3)*e)}function ht(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(t-a)/((arguments.length>4&&void 0!==arguments[4]?arguments[4]:5)-a)*(n-e)+e;return Math.max(0,r)}var mt={eth_tank:{barMax:100,zero:3.99,span:16.02},lox_tank:{barMax:100,zero:3.99,span:16.04},eth_n2:{barMax:250,zero:4,span:16},lox_n2:{barMax:250,zero:4,span:16},lox_cryo:{minFlow:.8,maxFlow:29,minVolts:0,maxVolts:5,type:"flow",kFactor:1686.8699,serialNumber:"130228-06"}};function ft(t,e){return 14.504*(e/2.4*(t-.48))}var dt={time:NaN,"LOX Tank":NaN,"LOX N2":NaN,"ETH Tank":NaN,"ETH N2":NaN};function pt(t){return 26*t}function yt(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.enabled;return Object(a.a)({position:"absolute",borderStyle:"solid",borderColor:"transparent",width:pt(r),height:pt(i),top:pt(n),left:pt(e)},o?{}:{cursor:"help"})}function gt(t){var e=t.state,n=t.emit,a=Object(p.a)(t,["state","emit"]),r=null!==e.data&&e.data.labjacks[a.test_stand].digital[a.labjack_pin],i=yt(a),o={position:"absolute",margin:"auto",fontSize:"1rem",top:pt(a.y-1),left:pt(a.x-1)-6,width:100,textAlign:"center"};return m.a.createElement("div",null,e.data&&m.a.createElement("div",{style:i,title:a.enabled?"":"Please enable the arming and manual control switches to toggle"},m.a.createElement(v.a,{checked:r,onChange:function(){return e.data.labjacks[a.test_stand].digital[a.labjack_pin]?n("CLOSE",{name:a.test_stand,pin:parseInt(a.labjack_pin)}):n("OPEN",{name:a.test_stand,pin:parseInt(a.labjack_pin)})},disabled:!a.enabled}),m.a.createElement("label",{className:(r?"active":"inactive")+" control-label "+(a.enabled?"":"disabled")},m.a.createElement("br",null),r?"Open":"Closed")),m.a.createElement("h4",{style:o},a.title))}function vt(t){var e=t.state,n=(t.emit,Object(p.a)(t,["state","emit"])),r=yt(Object(a.a)({enabled:!0},n)),i=null,o=null,l="";if(e.data){i=e.data.labjacks[n.test_stand].analog[n.labjack_pin];var s=mt[n.sensorName];if(s)if("flow"===s.type)l="GPM",(o=ht(i,s.minFlow,s.maxFlow,s.minVolts,s.maxVolts))>s.minFlow+.1&&(r.backgroundColor="lightgreen");else{l="PSI";(o=ut(i,s.barMax,s.zero,s.span))&&o>29.3918&&(r.backgroundColor="tomato")}}return m.a.createElement("div",{style:r},m.a.createElement("div",null,n.title),null!==o&&m.a.createElement("div",null,o.toFixed(1)," ",l),i&&m.a.createElement("div",null,"(",i.toFixed(2),"V)"))}function bt(t){var e=t.state,n=t.emit;return m.a.createElement(E,{title:"Control Panel",className:"panel control"},m.a.createElement("div",{className:"control-panel"},D.buttons.map(function(t){return e.data&&m.a.createElement(gt,Object.assign({title:t.pin.test_stand.charAt(0)+" "+t.pin.abbrev,key:t.pin.name,state:e,emit:n},t.pin,t.position,{enabled:e.data&&e.data.arming_switch&&e.data.manual_switch}))}),D.sensors.map(function(t){return e.data&&m.a.createElement(vt,Object.assign({title:t.pin.abbrev,key:t.pin.name,state:e,emit:n},t.pin,t.position,{sensorName:t.pin.abbrev}))})))}var kt=n(87),Et=n(86),xt=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(l.a)(this,Object(s.a)(e).call(this,t))).state={data:null,mostRecentWarning:{},showWarning:!1,wsAddress:localStorage.getItem("wsaddr")||"192.168.0.5",defaultWSAddress:"192.168.0.5",events:[],socketStatus:-1},n.emit=n.emit.bind(Object(u.a)(Object(u.a)(n))),n.connect(),n}return Object(c.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.interval=setInterval(function(){return t.emit("PING")},200),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1,clearInterval(this.interval)}},{key:"pushWarning",value:function(t,e){(!this.state.mostRecentWarning||this.state.mostRecentWarning.time!==t&&this.state.mostRecentWarning.message!==e)&&this.setState({mostRecentWarning:{time:t,message:e},showWarning:!0})}},{key:"updateSocketStatus",value:function(){if(this.socket){var t={socketStatus:this.socket.readyState};this.socket.readyState!==WebSocket.OPEN&&this.pushWarning((new Date).getTime(),"Server connection lost"),this.setState(t)}}},{key:"connect",value:function(){var t=this;this.socket&&this.socket.close();try{this.socket=new WebSocket("ws://".concat(this.state.wsAddress,":8888")),this.updateSocketStatus(),this.socket.onopen=function(e){console.log("websocket connection established"),t.updateSocketStatus()},this.socket.onclose=function(e){t.updateSocketStatus(),t.socket=null,console.log("websocket connection lost. reconnecting..."),Y(dt),setTimeout(function(){t.socket||t.connect()},1e3)},this.socket.onmessage=function(e){if(t.mounted){t.updateSocketStatus();var n,i,o=JSON.parse(e.data);switch(o.type){case"STATE":o.data.time=parseInt(o.data.time)/1e3;var l=V(function(){return t.state.data.time});o.data.time-l>1&&Y(dt),Y({time:(i=o.data).time,"LOX Tank":ut(i.labjacks.LOX.analog[4],mt.lox_tank.barMax,mt.lox_tank.zero,mt.lox_tank.span),"LOX N2":ft(i.labjacks.LOX.analog[5],250),"ETH Tank":ut(i.labjacks.ETH.analog[4],mt.eth_tank.barMax,mt.eth_tank.zero,mt.eth_tank.span),"ETH N2":ft(i.labjacks.ETH.analog[5],250),"LOX Flow":ht(i.labjacks.LOX.analog[2],mt.lox_cryo.minFlow,mt.lox_cryo.maxFlow)}),t.setState({data:o.data}),o.data.latest_warning&&t.pushWarning(o.data.latest_warning[0],o.data.latest_warning[1]);break;case"PING":t.setState({ping:(new Date).getTime()-o.data});break;case"VALVE":var s=o.time/1e3,c=q(o.data.pin).pin,u=("CLOSE"===o.data.header?"Closed":"Opened")+" "+c.test_stand+" "+c.abbrev;n={time:s,label:u},document.dispatchEvent(new CustomEvent("datalogger-new-event",{detail:n})),t.setState({events:[].concat(Object(r.a)(t.state.events),[Object(a.a)({},o.data,{label:u,time:s})])});break;default:console.error(o)}}}}catch(e){console.error(e)}}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({header:t,data:e,time:(new Date).getTime()}))}},{key:"render",value:function(){var t=this;return m.a.createElement("div",null,m.a.createElement(k,null),m.a.createElement("div",{className:"panels-root"},m.a.createElement("div",{className:"panel-row-1"},m.a.createElement(_,{state:this.state,emit:this.emit,sockStatus:this.state.socketStatus,that:this}),m.a.createElement(ct,{state:this.state,emit:this.emit})),m.a.createElement("div",{className:"panel-row-2"},m.a.createElement(bt,{state:this.state,emit:this.emit}),m.a.createElement($,{state:this.state,emit:this.emit})),this.state.showWarning&&m.a.createElement(kt.a,{open:!0,onClose:function(){return t.setState({showWarning:!1})},message:this.state.mostRecentWarning.message,action:m.a.createElement(Et.a,{onClick:function(){return t.setState({showWarning:!1})},style:{color:"white",textTransform:"none",textDecoration:"underline"}},"Dismiss")})))}}]),e}(m.a.Component);d.a.render(m.a.createElement(m.a.StrictMode,null,m.a.createElement(xt,null)),document.getElementById("root"))}},[[51,2,1]]]);
//# sourceMappingURL=main.706ce79a.chunk.js.map